<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pierre Meyer - Personal Website</title>
    <link href="styles.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-eYNu0jb43IMkTn2+Nxgu6xzDzYZPGCmRUpZxyxvgz6wS7NczPdQK1yUpSbtDsGCsP/amxhjvUYK0ouwFgag=="
          crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJx1qWndGzgGcRJTHWCVBS0kJxqJmCPGko3o0yrnAo0I1+KtKLiKs6utvXkduZPIWmPcwIg=="
            crossorigin=""></script>
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #f4f4f4;
            color: #333;
        }
        .container {
            width: 90%;
            max-width: 1200px;
            margin: auto;
            text-align: center;
        }
        header, footer {
            background-color: #222;
            color: #fff;
            padding: 20px 0;
        }
        .profile-pic {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            margin: 20px auto;
            border: 4px solid #444;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: block;
        }
        h1, h2 {
            margin-bottom: 15px;
        }
        .market-data-container {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin: 20px 0;
            justify-content: center;
        }
        .market-card {
            flex: 1 1 350px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
            padding: 20px;
            text-align: center;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .market-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }
        .market-title {
            font-size: 1.1em;
            margin-bottom: 10px;
            font-weight: 600;
            color: #444;
        }
        .current-price {
            font-size: 1.8em;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        .price-change {
            font-size: 0.8em;
            padding: 5px 10px;
            border-radius: 20px;
            color: #fff;
            margin-bottom: 10px;
        }
        .positive {
            background-color: #28a745;
        }
        .negative {
            background-color: #dc3545;
        }
        .graph-container {
            width: 90%;
            max-width: 400px;
            margin: 15px auto;
            height: 200px; /* Set a fixed height for the graphs */
        }
        .graph-container canvas {
            width: 100% !important;
            height: 100% !important;
            display: block; /* Ensure canvas takes up the container space */
        }
        .graph-title {
            font-size: 0.9em;
            color: #777;
            margin-bottom: 5px;
            font-style: italic;
        }
        #flightMap {
            height: 400px;
            width: 80%;
            margin: 20px auto;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .btn {
            display: inline-block;
            background-color: #444;
            color: #fff;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            border-radius: 5px;
            font-weight: 600;
            margin-bottom: 20px;
        }
        .btn:hover {
            background-color: #666;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Pierre Meyer</h1>
            <img src="profile.jpeg" alt="Pierre Meyer" class="profile-pic">
            <p>Business Development Manager | Multilingual Professional | Based in Taipei</p>
        </div>
    </header>

    <main class="container">
        <section>
            <h2>About Me</h2>
            <p>
                Hey there! I’m Pierre Meyer, a business development professional with a passion for connecting cultures and driving growth. I’ve had the unique experience of building my career across Germany and Taiwan, working at the intersection of global business strategy and relationship management.
            </p>
            <p>
                My background spans regulatory affairs, project assistance, and business strategy, with a knack for finding creative solutions in fast-paced environments. I thrive in international settings, leveraging my fluency in English, German, and Chinese to bridge communication gaps and build meaningful connections.
            </p>
        </section>

        <hr class="divider">

        <section>
            <h2>My CV</h2>
            <p>
                <a href="CV.pdf" target="_blank" class="btn">Download My CV</a>
            </p>
        </section>

        <hr class="divider">

        <section>
            <h2>My Flight History</h2>
            <div id="flightMap"></div>
        </section>

        <hr class="divider">

        <section>
            <h2>Live Market Prices</h2>
            <div class="market-data-container">
                <div class="market-card">
                    <h3 class="market-title">Bitcoin (BTC)</h3>
                    <div class="current-price" id="btc-price">Loading...</div>
                    <div class="price-change" id="btc-change">-</div>
                    <div class="graph-container">
                        <h4 class="graph-title">Last 7 Days</h4>
                        <canvas id="btc-chart-7d"></canvas>
                    </div>
                    <div class="graph-container">
                        <h4 class="graph-title">Last 30 Days</h4>
                        <canvas id="btc-chart-30d"></canvas>
                    </div>
                </div>
                <div class="market-card">
                    <h3 class="market-title">Ethereum (ETH)</h3>
                    <div class="current-price" id="eth-price">Loading...</div>
                    <div class="price-change" id="eth-change">-</div>
                    <div class="graph-container">
                        <h4 class="graph-title">Last 7 Days</h4>
                        <canvas id="eth-chart-7d"></canvas>
                    </div>
                    <div class="graph-container">
                        <h4 class="graph-title">Last 30 Days</h4>
                        <canvas id="eth-chart-30d"></canvas>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>© 2025 Pierre Meyer | <a href="mailto:pierremeyer@outlook.de">Contact Me</a></p>
        </div>
    </footer>

    <script>
    let btcChart7d, ethChart7d, btcChart30d, ethChart30d;

    function formatPrice(price) {
        return `$${price.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
    }

    function updatePriceCard(elementId, price, change) {
        const priceElement = document.getElementById(`${elementId}-price`);
        const changeElement = document.getElementById(`${elementId}-change`);

        priceElement.textContent = formatPrice(price);
        changeElement.textContent = `${change >= 0 ? "+" : ""}${change.toFixed(2)}%`;
        changeElement.className = `price-change ${change >= 0 ? "positive" : "negative"}`;
    }

    async function fetchMarketData() {
        try {
            const response = await fetch("https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum&vs_currencies=usd&include_24hr_change=true");
            const priceData = await response.json();

            const btcPrice = priceData.bitcoin.usd;
            const btcChange = priceData.bitcoin.usd_24h_change;
            updatePriceCard("btc", btcPrice, btcChange);

            const ethPrice = priceData.ethereum.usd;
            const ethChange = priceData.ethereum.usd_24h_change;
            updatePriceCard("eth", ethPrice, ethChange);

            // Fetch historical data for graphs
            await fetchHistoricalData('bitcoin', 'usd', 7, 'btc-chart-7d');
            await fetchHistoricalData('ethereum', 'usd', 7, 'eth-chart-7d');
            await fetchHistoricalData('bitcoin', 'usd', 30, 'btc-chart-30d');
            await fetchHistoricalData('ethereum', 'usd', 30, 'eth-chart-30d');

        } catch (error) {
            console.error("Error fetching market data:", error);
        }
    }

    async function fetchHistoricalData(coinId, currency, days, chartId) {
        try {
            const response = await fetch(`https://api.coingecko.com/api/v3/coins/${coinId}/market_chart?vs_currency=${currency}&days=${days}`);
            const historicalData = await response.json();
            const prices = historicalData.prices.map(price => price[1]);
            const timestamps = historicalData.prices.map(price => new Date(price[0]).toLocaleDateString());

            // Determine trend for color
            const firstPrice = prices[0];
            const lastPrice = prices[prices.length - 1];
            const trendColor = lastPrice >= firstPrice ? '#3fb950' : '#f85149';

            renderChart(chartId, timestamps, prices, trendColor);
        } catch (error) {
            console.error(`Error fetching historical data for ${coinId} (${days} days):`, error);
        }
    }

    function renderChart(chartId, labels, data, borderColor) {
        const ctx = document.getElementById(chartId).getContext('2d');
        if (chartId.includes('7d')) {
            if (chartId === 'btc-chart-7d' && btcChart7d) {
                btcChart7d.destroy();
            } else if (chartId === 'eth-chart-7d' && ethChart7d) {
                ethChart7d.destroy();
            }
        } else if (chartId.includes('30d')) {
            if (chartId === 'btc-chart-30d' && btcChart30d) {
                btcChart30d.destroy();
            } else if (chartId === 'eth-chart-30d' && ethChart30d) {
                ethChart30d.destroy();
            }
        }

        const newChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Price (USD)',
                    data: data,
                    borderColor: borderColor,
                    borderWidth: 2,
                    fill: false,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: false,
                        ticks: {
                            display: false
                        },
                        grid: {
                            display: false
                        }
                    },
                    x: {
                        ticks: {
                            display: false
                        },
                        grid: {
                            display: false
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `Price: $${context.parsed.y.toFixed(2)}`;
                            }
                        }
                    }
                }
            });

            if (chartId === 'btc-chart-7d') {
                btcChart7d = newChart;
            } else if (chartId === 'eth-chart-7d') {
                ethChart7d = newChart;
            } else if (chartId === 'btc-chart-30d') {
                btcChart30d = newChart;
            } else if (chartId === 'eth-chart-30d') {
                ethChart30d = newChart;
            }
        }

        async function loadFlightData() {
            try {
                const response = await fetch('flights.csv'); // Adjust the path if needed
                const csvText = await response.text();
                const flights = parseCSV(csvText);
                processFlightDataForMap(flights); // Separate function to handle map logic
            } catch (error) {
                console.error("Error fetching CSV file:", error);
            }
        }

        function parseCSV(csvString) {
            const lines = csvString.trim().split('\n');
            const headers = lines[0].split(',');
            const result = [];
            for (let i = 1; i < lines.length; i++) {
                const obj = {};
                const currentLine = lines[i].split(',');
                for (let j = 0; j < headers.length; j++) {
                    obj[headers[j].trim()] = currentLine[j].trim();
                }
                result.push(obj);
            }
            return result;
        }

        async function processFlightDataForMap(flights) {
            try {
                const response = await fetch('airports.csv');
                const airportsCsvText = await response.text();
                const airports = parseAirportsCSV(airportsCsvText);
                const airportCoordinates = {};

                airports.forEach(airport => {
                    if (airport.iata_code) {
                        airportCoordinates[airport.iata_code] = [parseFloat(airport.latitude_deg), parseFloat(airport.longitude_deg)];
                    }
                });

                const map = L.map('flightMap').setView([0, 0], 2);

                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }).addTo(map);

                flights.forEach(flight => {
                    const fromCoords = airportCoordinates[flight["From"]];
                    const toCoords = airportCoordinates[flight["To"]];

                    if (fromCoords && toCoords) {
                        L.marker(fromCoords).addTo(map).bindPopup(`Departure: ${flight["From"]}`);
                        L.marker(toCoords).addTo(map).bindPopup(`Arrival: ${flight["To"]}`);
                        L.polyline([fromCoords, toCoords], { color: 'blue' }).addTo(map);
                    } else {
                        console.warn(`Coordinates not found for one of the airports: ${flight["From"]}, ${flight["To"]}`);
                    }
                });

                const bounds = new L.LatLngBounds();
                flights.forEach(flight => {
                    const fromCoords = airportCoordinates[flight["From"]];
                    const toCoords = airportCoordinates[flight["To"]];
                    if (fromCoords && toCoords) {
                        bounds.extend(fromCoords);
                        bounds.extend(toCoords);
                    }
                });
                map.fitBounds(bounds, { padding: [20, 20] });

            } catch (error) {
                console.error("Error loading airport data:", error);
            }
        }

        function parseAirportsCSV(csvString) {
            const lines = csvString.trim().split('\n');
            const headers = lines[0].split(',');
            const result = [];
            for (let i = 1; i < lines.length; i++) {
                const obj = {};
                const currentLine = lines[i].split(',');
                for (let j = 0; j < headers.length; j++) {
                    obj[headers[j].trim()] = currentLine[j].trim();
                }
                // We only care about real airports with IATA codes
                if (obj.iata_code && obj.iata_code.length === 3) {
                    result.push(obj);
                }
            }
            return result;
        }

        // Initial load
        fetchMarketData();

        // Real-time updates every 5 seconds (for price only)
        setInterval(async () => {
            try {
                const response = await fetch("https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum&vs_currencies=usd&include_24hr_change=true");
                const priceData = await response.json();

                const btcPrice = priceData.bitcoin.usd;
                const btcChange = priceData.bitcoin.usd_24h_change;
                updatePriceCard("btc", btcPrice, btcChange);

                const ethPrice = priceData.ethereum.usd;
                const ethChange = priceData.ethereum.usd_24h_change;
                updatePriceCard("eth", ethPrice, ethChange);
            } catch (error) {
                console.error("Error fetching live prices:", error);
            }
        }, 5000);

        loadFlightData();
        </script>

    </body>
    </html>
