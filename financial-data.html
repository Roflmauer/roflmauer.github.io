<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Data - Pierre Meyer</title>
    <link href="styles.css" rel="stylesheet">
</head>
<body>
<header>
    <div class="container">
        <h1>Financial Data</h1>
        <p>Real-time global index performances</p>
    </div>
</header>

<main class="container">
    <table id="index-table">
        <thead>
            <tr>
                <th>Index</th>
                <th>Price</th>
                <th>Change</th>
                <th>% Change</th>
            </tr>
        </thead>
        <tbody>
            <!-- Rows will be filled dynamically -->
        </tbody>
    </table>
</main>

<footer>
    <div class="container">
        <p>Â© 2025 Pierre Meyer | <a href="index.html">Back to Home</a></p>
    </div>
</footer>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const indices = {
        "DAX (Germany)": "^GDAXI",
        "TAIEX (Taiwan)": "^TWII",
        "S&P 500 (US)": "^GSPC",
        "FTSE 100 (UK)": "^FTSE",
        "Nikkei 225 (Japan)": "^N225",
        "CAC 40 (France)": "^FCHI",
        "Hang Seng (Hong Kong)": "^HSI",
        "Sensex (India)": "^BSESN",
        "ASX 200 (Australia)": "^AXJO",
        "Shanghai Composite (China)": "000001.SS"
    };

    const tableBody = document.querySelector("#index-table tbody");

    async function fetchIndexData(symbol) {
        try {
            const response = await fetch(`https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?interval=1m`);
            const data = await response.json();
            const lastClose = data.chart.result[0].meta.regularMarketPreviousClose;
            const currentPrice = data.chart.result[0].meta.regularMarketPrice;
            const change = currentPrice - lastClose;
            const changePercent = ((change / lastClose) * 100).toFixed(2);
            return {
                price: currentPrice.toFixed(2),
                change: change.toFixed(2),
                changePercent: changePercent
            };
        } catch (error) {
            console.error("Error fetching index data:", error);
            return null;
        }
    }

    function updateTable() {
        tableBody.innerHTML = ""; // Clear existing rows
        Object.keys(indices).forEach(async (name) => {
            const data = await fetchIndexData(indices[name]);
            if (data) {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${name}</td>
                    <td>$${data.price}</td>
                    <td class="${data.change >= 0 ? 'positive' : 'negative'}">${data.change}</td>
                    <td class="${data.changePercent >= 0 ? 'positive' : 'negative'}">${data.changePercent}%</td>
                `;
                tableBody.appendChild(row);
            }
        });
    }

    updateTable();
    setInterval(updateTable, 60000); // Refresh every 60 seconds
});
</script>

</body>
</html>
