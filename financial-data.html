<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Data - Pierre Meyer</title>
    <link href="styles.css" rel="stylesheet">
</head>
<body>
<header>
    <div class="container">
        <h1>Financial Data</h1>
        <p>Real-time global index performances</p>
    </div>
</header>

<main class="container">
    <div id="map-container">
        <!-- Embed the SVG directly for better styling -->
        <object id="world-map" type="image/svg+xml" data="world-map.svg"></object>
    </div>
    <div id="index-data"></div>
</main>

<footer>
    <div class="container">
        <p>Â© 2025 Pierre Meyer | <a href="index.html">Back to Home</a></p>
    </div>
</footer>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const indices = {
        "Germany": "^GDAXI",
        "Taiwan": "^TWII",
        "United States": "^GSPC",
        "United Kingdom": "^FTSE",
        "Japan": "^N225",
        "France": "^FCHI",
        "Hong Kong": "^HSI",
        "India": "^BSESN",
        "Australia": "^AXJO",
        "China": "000001.SS"
    };

    async function fetchIndexData(symbol) {
        try {
            const response = await fetch(`https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?interval=1m`);
            const data = await response.json();
            const lastClose = data.chart.result[0].meta.regularMarketPreviousClose;
            const currentPrice = data.chart.result[0].meta.regularMarketPrice;
            const change = currentPrice - lastClose;
            const changePercent = ((change / lastClose) * 100).toFixed(2);
            return {
                price: currentPrice.toFixed(2),
                change: change.toFixed(2),
                changePercent: changePercent
            };
        } catch (error) {
            console.error("Error fetching index data:", error);
            return null;
        }
    }

    // Update map with data
    Object.keys(indices).forEach(async (country) => {
        const data = await fetchIndexData(indices[country]);
        if (data) {
            const region = document.querySelector(`[data-country="${country}"]`);
            if (region) {
                region.innerHTML = `
                    <strong>${country}</strong><br>
                    $${data.price} (${data.change} / ${data.changePercent}%)
                `;
                region.classList.add(data.change > 0 ? "positive" : "negative");
            }
        }
    });
});
</script>

</body>
</html>
