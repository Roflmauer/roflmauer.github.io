<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taiwan-Germany Trade Report - Pierre Meyer</title>
    <link href="styles.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
        }
        .introductory-narrative {
            color: #a0aec0;
            margin-top: 1.5rem;
            margin-bottom: 2.5rem;
            line-height: 1.7;
        }
        .introductory-narrative p {
            margin-bottom: 1rem;
        }
        .introductory-narrative strong {
            color: #cbd5e0;
            font-weight: 600;
        }
        .chart-title-style {
            font-size: 1.25em;
            font-weight: 600;
            text-align: center;
            color: #cbd5e0;
            margin-top: 0;
            margin-bottom: 1rem;
        }
        .chart-wrapper canvas {
            background-color: transparent !important;
        }
        .kpi-container {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .kpi {
            background-color: #161b22;
            color: #c9d1d9;
            padding: 1.5rem;
            border-radius: 0.5rem;
            text-align: center;
            flex-grow: 1;
            min-width: 200px;
            border: 1px solid #30363d;
            box-shadow: 0 3px 6px rgba(0,0,0,0.25);
        }
        .kpi h3 {
            font-size: 1rem;
            font-weight: 600;
            color: #8b949e;
            margin-top: 0;
            margin-bottom: 0.5rem;
        }
        .kpi p {
            font-size: 1.5rem;
            font-weight: 700;
            color: #58a6ff;
            margin-bottom: 0;
            text-align: center;
        }
        .loading-message-placeholder, .error-message-placeholder {
            text-align: center;
            color: #a0aec0;
            padding: 1rem;
            min-height: 40px;
        }
        .error-message-placeholder {
            color: #f87171;
        }
    </style>
</head>
<body>
    <div class="background-animation"></div>

    <header>
        <div class="container header-content-wrapper">
            <img src="profile.jpeg" alt="Pierre Meyer" class="profile-pic-header">
            <div class="header-text">
                <h1>Pierre Meyer</h1>
                <p>Business Development Manager | Multilingual Professional | Based in Taipei</p>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="trade-report-main-content">
            <h1 class="text-3xl sm:text-4xl font-bold text-center mb-6">Taiwan-Germany Trade Report</h1>

            <div class="introductory-narrative max-w-4xl mx-auto px-4">
                <p>The trade between Taiwan and Germany, both key players in advanced manufacturing and technology, reveals how global events and industry needs shape economic ties. Let's uncover the reasons behind the trends you see in the graphs, particularly the significant shifts since 2014.</p>
                <p><strong>The Upward Journey: Complementary Strengths</strong><br>
                The general growth in trade volume isn't accidental. It stems from deep economic interdependence. Germany's prowess in machinery, automotive, and chemicals complements Taiwan's leadership in semiconductors and ICT. As global demand for their respective specializations has grown, so has their bilateral trade.</p>
                <p><strong>The Acceleration (2019-2022) & Taiwan's Surplus Boom: Key Drivers</strong><br>
                The period around 2019-2022 saw a notable surge in trade activity and a significant increase in Taiwan's trade surplus with Germany. This was driven by several powerful factors:</p>
                <p><strong>Semiconductor Demand & Shortage:</strong> This was the primary catalyst. The global hunger for semiconductors, crucial for 5G, AI, and everyday electronics, intensified dramatically during the COVID-19 pandemic. Taiwan, a semiconductor manufacturing titan, saw its exports (especially to Germany's chip-starved automotive sector) soar in value.</p>
                <p><strong>Pandemic-Driven Demand:</strong> COVID-19 also boosted demand for consumer electronics, remote work infrastructure, and medical equipment—all key Taiwanese exports.</p>
                <p><strong>Supply Chain Adjustments:</strong> US-China trade tensions encouraged some businesses to diversify supply chains, potentially benefiting Taiwan as a reliable tech source.</p>
                <p>These factors led to Taiwan's exports to Germany growing much faster than its imports, causing the trade surplus to more than double between 2018 and 2022, as your text notes.</p>

                <div class="yearly-balance-chart-container mx-auto my-6 md:w-11/12 lg:w-5/6 xl:w-3/4">
                    <div class="chart-wrapper p-4 md:p-6">
                        <h2 id="chartTitleYearlyBalance" class="chart-title-style">Yearly Trade Balance (Exports - Imports)</h2>
                        <canvas id="yearlyTradeBalanceChart" style="max-height: 380px; width: 100%;"></canvas>
                    </div>
                    <div id="loadingYearlyTradeBalance" class="loading-message-placeholder" style="display:none;">Calculating yearly balance...</div>
                    <div id="errorYearlyTradeBalance" class="error-message-placeholder" style="display:none;"></div>
                </div>

                <p><strong>Recent Shifts (Post-2022): Normalization and New Influences</strong><br>
                The graphs likely show a moderation in Taiwan's trade surplus after its 2022 peak. This shift can be attributed to:</p>
                <p><strong>Easing of Chip Shortages:</strong> As semiconductor supply caught up with demand, the extraordinary export values began to normalize.</p>
                <p><strong>Global Economic Headwinds:</strong> Economic slowdowns and inflation in various parts of the world, including Germany, likely dampened overall import demand.</p>
                <p><strong>In Conclusion: A Dynamic Relationship</strong><br>
                The Taiwan-Germany trade figures reflect a dynamic interplay of industrial strengths, technological waves (especially in semiconductors), and global events. The "Latest" figures on your chart are a snapshot of this ever-evolving economic story. To explore further, consider official trade statistics from both nations or reports from international economic organizations.</p>
            </div>

            <div class="kpi-container">
                <div class="kpi">
                    <h3>Latest Imports (Trade)</h3>
                    <p id="latestImportValue">---</p>
                </div>
                <div class="kpi">
                    <h3>Latest Exports (Trade)</h3>
                    <p id="latestExportValue">---</p>
                </div>
                <div class="kpi">
                    <h3>Latest Trade Balance</h3>
                    <p id="latestTradeBalance">---</p>
                </div>
            </div>

            <div class="chart-wrapper">
                <h2 id="chartTitleTrade" class="chart-title-style">Trade Value Over Time (Monthly)</h2>
                <canvas id="tradeChart"></canvas>
            </div>
            <div id="loadingMessage" class="loading-message-placeholder">Loading trade data...</div>
            <div id="errorMessage" class="error-message-placeholder" style="display:none;"></div>

        </div>
    </main>
    <footer>
        <div class="container">
            <p>© <span id="currentYear">2025</span> Pierre Meyer | <a href="mailto:pierremeyer@outlook.de">Contact Me</a></p>
            <p><a href="index.html">Back to Home</a></p>
        </div>
    </footer>

    <script>
        // Set Chart.js Global Defaults
        Chart.defaults.font.family = 'Montserrat';
        Chart.defaults.color = '#a0aec0';
        Chart.defaults.borderColor = '#4a5568';
        Chart.defaults.plugins.legend.labels.color = '#cbd5e0';

        // --- Configuration ---
        const TRADE_IMPORT_FILE_NAME = 'Imports_from_Germany_to_Taiwan_Over_Time.json';
        const TRADE_EXPORT_FILE_NAME = 'Exports_from_Taiwan_to_Germany_Over_Time.json';
        const TRADE_CURRENCY_SYMBOL = '$';
        const TRADE_CURRENCY_CODE = 'USD';
        const ROLLING_AVERAGE_WINDOW = 12;

        // --- Helper Functions ---
        function formatCurrency(value, symbol) {
            if (isNaN(value) || value === null) return 'N/A';
            return symbol + value.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
        }

        function calculateRollingAverage(data, windowSize) {
            const rollingAvg = [];
            if (!data || data.length === 0) return rollingAvg;

            for (let i = 0; i < data.length; i++) {
                if (i < windowSize - 1) {
                    rollingAvg.push(null);
                } else {
                    let sum = 0;
                    let count = 0;
                    for (let j = 0; j < windowSize; j++) {
                        if (typeof data[i - j] === 'number' && data[i-j] !== null) {
                            sum += data[i - j];
                            count++;
                        }
                    }
                    rollingAvg.push(count > 0 ? sum / count : null);
                }
            }
            return rollingAvg;
        }

        // --- Trade Data Functions ---
        async function fetchTradeData(fileName) {
            try {
                const response = await fetch(fileName);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status} for ${fileName}`);
                }
                const jsonData = await response.json();
                const datasetKey = Object.keys(jsonData.datasets)[0];
                if (!datasetKey || !jsonData.datasets[datasetKey]) {
                    throw new Error(`Could not find data array in ${fileName} under 'datasets'.`);
                }
                return jsonData.datasets[datasetKey].map(item => ({
                    date: new Date(item.Date),
                    value: parseFloat(item.Value)
                })).sort((a, b) => a.date - b.date);
            } catch (error) {
                console.error(`Error fetching or parsing ${fileName}:`, error);
                throw error;
            }
        }

        function calculateYearlyTradeBalance(importData, exportData) {
            const yearlyData = {};

            exportData.forEach(item => {
                const year = item.date.getFullYear().toString();
                if (!yearlyData[year]) {
                    yearlyData[year] = { exports: 0, imports: 0, exportMonths: 0, importMonths: 0 };
                }
                yearlyData[year].exports += item.value;
                yearlyData[year].exportMonths++;
            });

            importData.forEach(item => {
                const year = item.date.getFullYear().toString();
                if (!yearlyData[year]) {
                    yearlyData[year] = { exports: 0, imports: 0, exportMonths: 0, importMonths: 0 };
                }
                yearlyData[year].imports += item.value;
                yearlyData[year].importMonths++;
            });

            const result = {
                labels: [],
                balances: [],
                isPartial: []
            };

            const sortedYears = Object.keys(yearlyData).sort();

            for (const year of sortedYears) {
                result.labels.push(year);
                result.balances.push(yearlyData[year].exports - yearlyData[year].imports);

                const isLastYearInDataset = year === sortedYears[sortedYears.length -1];
                if (isLastYearInDataset && (yearlyData[year].exportMonths < 12 || yearlyData[year].importMonths < 12)) {
                    result.isPartial.push(true);
                } else {
                    result.isPartial.push(false);
                }
            }
            return result;
        }

        function renderYearlyTradeBalanceChart(yearlyBalanceData) {
            const loadingEl = document.getElementById('loadingYearlyTradeBalance');
            const errorEl = document.getElementById('errorYearlyTradeBalance');
            const canvasEl = document.getElementById('yearlyTradeBalanceChart');

            if (!canvasEl) {
                console.error('Yearly Trade Balance chart canvas element not found!');
                if(errorEl) {
                    errorEl.textContent = 'Chart canvas missing for yearly balance.';
                    errorEl.style.display = 'block';
                }
                if (loadingEl) loadingEl.style.display = 'none';
                return;
            }

            if (loadingEl) loadingEl.style.display = 'none';

            const ctx = canvasEl.getContext('2d');
            const barColors = yearlyBalanceData.balances.map(balance => balance >= 0 ? 'rgba(75, 192, 192, 0.7)' : 'rgba(255, 99, 132, 0.7)');
            const borderColors = yearlyBalanceData.balances.map(balance => balance >= 0 ? 'rgba(75, 192, 192, 1)' : 'rgba(255, 99, 132, 1)');

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: yearlyBalanceData.labels,
                    datasets: [{
                        label: 'Yearly Trade Balance',
                        data: yearlyBalanceData.balances,
                        backgroundColor: barColors,
                        borderColor: borderColors,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            title: { display: true, text: `Trade Balance (${TRADE_CURRENCY_CODE})`, color: '#c9d1d9', font: { family: 'Montserrat'} },
                            ticks: {
                                color: '#8b949e', font: { family: 'Montserrat'},
                                callback: function(value) {
                                    if (Math.abs(value) >= 1e9) return TRADE_CURRENCY_SYMBOL + (value / 1e9).toFixed(1) + 'B';
                                    if (Math.abs(value) >= 1e6) return TRADE_CURRENCY_SYMBOL + (value / 1e6).toFixed(1) + 'M';
                                    return TRADE_CURRENCY_SYMBOL + value.toLocaleString('en-US');
                                }
                            },
                            grid: { color: '#30363d' }
                        },
                        x: {
                            title: { display: true, text: 'Year', color: '#c9d1d9', font: { family: 'Montserrat'} },
                            ticks: { color: '#8b949e', font: { family: 'Montserrat'} },
                            grid: { color: '#30363d' }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            titleFont: { family: 'Montserrat' }, bodyFont: { family: 'Montserrat' },
                            mode: 'index',
                            intersect: false,
                            titleColor: '#fff', bodyColor: '#fff', backgroundColor: 'rgba(0,0,0,0.8)',
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) { label += ': '; }
                                    if (context.parsed.y !== null) {
                                        label += formatCurrency(context.parsed.y, TRADE_CURRENCY_SYMBOL);
                                    }
                                    const currentYearIndex = context.dataIndex;
                                    if (yearlyBalanceData.isPartial[currentYearIndex]) {
                                        label += ' (Partial Year)';
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }

        async function displayTradeVisualizations() {
            const loadingMessageEl = document.getElementById('loadingMessage');
            const errorMessageEl = document.getElementById('errorMessage');

            if(loadingMessageEl) loadingMessageEl.style.display = 'block';
            if(errorMessageEl) errorMessageEl.style.display = 'none';


            try {
                const importData = await fetchTradeData(TRADE_IMPORT_FILE_NAME);
                const exportData = await fetchTradeData(TRADE_EXPORT_FILE_NAME);

                if(loadingMessageEl) loadingMessageEl.style.display = 'none';

                if (!importData.length || !exportData.length) {
                   throw new Error("No trade data points found after processing files.");
                }
                const labels = importData.map(item => item.date);
                const importValues = importData.map(item => item.value);
                const exportValues = exportData.map(item => item.value);

                const importRollingAvg = calculateRollingAverage(importValues, ROLLING_AVERAGE_WINDOW);
                const exportRollingAvg = calculateRollingAverage(exportValues, ROLLING_AVERAGE_WINDOW);

                const latestImport = importData[importData.length - 1];
                const latestExport = exportData[exportData.length - 1];
                if(document.getElementById('latestImportValue')) document.getElementById('latestImportValue').textContent = formatCurrency(latestImport.value, TRADE_CURRENCY_SYMBOL);
                if(document.getElementById('latestExportValue')) document.getElementById('latestExportValue').textContent = formatCurrency(latestExport.value, TRADE_CURRENCY_SYMBOL);
                if(document.getElementById('latestTradeBalance')) document.getElementById('latestTradeBalance').textContent = formatCurrency(latestExport.value - latestImport.value, TRADE_CURRENCY_SYMBOL);

                const monthlyChartCanvas = document.getElementById('tradeChart');
                if (monthlyChartCanvas) {
                    const ctxMonthly = monthlyChartCanvas.getContext('2d');
                    new Chart(ctxMonthly, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [
                                {
                                    label: 'Imports from Germany', data: importValues,
                                    borderColor: 'rgba(255, 99, 132, 1)', backgroundColor: 'rgba(255, 99, 132, 0.2)',
                                    tension: 0.1, fill: true, pointRadius: 2,
                                    pointBackgroundColor: 'rgba(255, 99, 132, 1)', pointBorderColor: '#fff'
                                },
                                {
                                    label: `Imports (${ROLLING_AVERAGE_WINDOW}-Month Avg)`, data: importRollingAvg,
                                    borderColor: 'rgba(255, 99, 132, 0.7)', borderWidth: 2,
                                    fill: false, tension: 0.1, pointRadius: 0,
                                },
                                {
                                    label: 'Exports to Germany', data: exportValues,
                                    borderColor: 'rgba(54, 162, 235, 1)', backgroundColor: 'rgba(54, 162, 235, 0.2)',
                                    tension: 0.1, fill: true, pointRadius: 2,
                                    pointBackgroundColor: 'rgba(54, 162, 235, 1)', pointBorderColor: '#fff'
                                },
                                {
                                    label: `Exports (${ROLLING_AVERAGE_WINDOW}-Month Avg)`, data: exportRollingAvg,
                                    borderColor: 'rgba(54, 162, 235, 0.7)', borderWidth: 2,
                                    fill: false, tension: 0.1, pointRadius: 0,
                                }
                            ]
                        },
                        options: {
                            responsive: true, maintainAspectRatio: true,
                            scales: {
                                x: { type: 'time', time: { unit: 'year', tooltipFormat: 'MMM yy', displayFormats: { month: 'MMM yy', year: 'yyyy' }},
                                    title: { display: true, text: 'Date', color: '#c9d1d9', font: { family: 'Montserrat'} },
                                    ticks: {color: '#8b949e', font: { family: 'Montserrat'}}, grid: {color: '#30363d'}
                                  },
                                y: { beginAtZero: true,
                                    title: { display: true, text: `Trade Value (${TRADE_CURRENCY_CODE})` , color: '#c9d1d9', font: { family: 'Montserrat'}},
                                    ticks: {color: '#8b949e', font: { family: 'Montserrat'}, callback: function(value) {
                                        if (Math.abs(value) >= 1e9) return TRADE_CURRENCY_SYMBOL + (value / 1e9).toFixed(1) + 'B';
                                        if (Math.abs(value) >= 1e6) return TRADE_CURRENCY_SYMBOL + (value / 1e6).toFixed(1) + 'M';
                                        return TRADE_CURRENCY_SYMBOL + value.toLocaleString('en-US');
                                    }},
                                    grid: {color: '#30363d'}
                                }
                            },
                            plugins: {
                                legend: { position: 'top', labels: {color: '#c9d1d9', font: { family: 'Montserrat'}} },
                                tooltip: {
                                    mode: 'index', intersect: false, titleColor: '#fff', bodyColor: '#fff', backgroundColor: 'rgba(0,0,0,0.8)',
                                    titleFont: { family: 'Montserrat' }, bodyFont: { family: 'Montserrat' },
                                    callbacks: { label: context => `${context.dataset.label || ''}: ${formatCurrency(context.parsed.y, TRADE_CURRENCY_SYMBOL)}` }
                                }
                            }
                        }
                    });
                } else {
                    console.error("Monthly trade chart canvas not found!");
                     if(errorMessageEl && loadingMessageEl) {
                        errorMessageEl.textContent = 'Error: Monthly trade chart canvas not found.';
                        errorMessageEl.style.display = 'block';
                        loadingMessageEl.style.display = 'none';
                    }
                }

                const yearlyBalanceData = calculateYearlyTradeBalance(importData, exportData);
                const loadingYearlyEl = document.getElementById('loadingYearlyTradeBalance');
                if (loadingYearlyEl) loadingYearlyEl.style.display = 'block';

                if (yearlyBalanceData.labels.length > 0) {
                    renderYearlyTradeBalanceChart(yearlyBalanceData);
                } else {
                    const errorYearlyEl = document.getElementById('errorYearlyTradeBalance');
                    if(errorYearlyEl) {
                        errorYearlyEl.textContent = 'Not enough data for yearly balance chart.';
                        errorYearlyEl.style.display = 'block';
                    }
                   if(loadingYearlyEl) loadingYearlyEl.style.display = 'none';
                }

            } catch (error) {
                console.error("Failed to display trade visualizations:", error);
                if(loadingMessageEl) loadingMessageEl.style.display = 'none';
                if(errorMessageEl) {
                    errorMessageEl.textContent = `Error loading trade data: ${error.message}.`;
                    errorMessageEl.style.display = 'block';
                }
                const loadingYearlyEl = document.getElementById('loadingYearlyTradeBalance');
                const errorYearlyEl = document.getElementById('errorYearlyTradeBalance');
                if(loadingYearlyEl) loadingYearlyEl.style.display = 'none';
                if(errorYearlyEl && errorYearlyEl.style.display === 'none') {
                    errorYearlyEl.textContent = `Could not generate yearly balance chart due to earlier error: ${error.message}`;
                    errorYearlyEl.style.display = 'block';
                }
            }
        }

        // --- Initial Load ---
        async function initializePage() {
            try {
                await displayTradeVisualizations();
            } catch (tradeError) {
                console.error("Error during trade visualizations.", tradeError);
            }
            // Update footer year
            const currentYearEl = document.getElementById('currentYear');
            if (currentYearEl) {
                currentYearEl.textContent = new Date().getFullYear();
            }
        }

        initializePage();
    </script>
</body>
</html>
